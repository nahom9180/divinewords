import{r as p,j as e,d as v,h as k}from"./index-Cen6tLtI.js";const S=({collection:s,onClose:m,onSave:g})=>{const[b,y]=p.useState((s==null?void 0:s.name)||""),[c,x]=p.useState("write"),[o,f]=p.useState(""),[d,l]=p.useState((s==null?void 0:s.items)||[]);p.useEffect(()=>{s&&s.items.length>0&&x("blocks")},[s]);const w=()=>{if(!o.trim())return;const t=k(o),r=[];let a=0;if(t.parsedReferences.sort((n,h)=>n.index-h.index).forEach(n=>{if(n.index>a){const h=o.substring(a,n.index);h.trim()&&r.push({id:`txt_${Date.now()}_${Math.random()}`,type:"text",content:h})}r.push({id:`ref_${Date.now()}_${Math.random()}`,type:"ref",ref:n.referenceString}),a=n.index+n.length}),a<o.length){const n=o.substring(a);n.trim()&&r.push({id:`txt_${Date.now()}_${Math.random()}`,type:"text",content:n})}r.length===0&&r.push({id:`txt_${Date.now()}_${Math.random()}`,type:"text",content:o}),l(n=>[...n,...r]),f(""),x("blocks")},u=(t,r)=>{const a=[...d],i=t+r;i>=0&&i<a.length&&([a[t],a[i]]=[a[i],a[t]],l(a))},j=t=>{l(r=>r.filter((a,i)=>i!==t))},N=async()=>{if(!b.trim())return alert("Please enter a title.");if(d.length===0&&!o.trim())return alert("SuperNote is empty.");let t=d;c==="write"&&o.trim()&&(t=[...d,{id:`txt_${Date.now()}`,type:"text",content:o}]);const r={name:b.trim(),items:t,createdAt:(s==null?void 0:s.createdAt)||Date.now(),updatedAt:Date.now()};s&&s.name!==b.trim()&&await v.deleteCollection(s.name),await v.saveCollection(r),window.dispatchEvent(new Event("DATA_REFRESH")),g(),m()};return e.jsxs("div",{className:"bg-bg border border-border w-full max-w-4xl rounded-xl shadow-2xl overflow-hidden flex flex-col h-[85vh] animate-in zoom-in-95 duration-200",children:[e.jsxs("div",{className:"p-4 border-b border-border bg-card flex justify-between items-center shrink-0",children:[e.jsx("input",{type:"text",value:b,onChange:t=>y(t.target.value),placeholder:"SuperNote Title...",className:"bg-transparent text-xl font-bold font-serif focus:outline-none placeholder:opacity-30 flex-1 mr-4"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:m,className:"px-4 py-2 text-xs font-bold uppercase opacity-50 hover:opacity-100",children:"Cancel"}),e.jsx("button",{onClick:N,className:"px-6 py-2 bg-brand text-white text-xs font-bold uppercase rounded hover:opacity-90",children:"Save"})]})]}),e.jsxs("div",{className:"flex-1 flex flex-col relative overflow-hidden",children:[e.jsxs("div",{className:"flex border-b border-border bg-card/50",children:[e.jsx("button",{onClick:()=>x("write"),className:`flex-1 py-3 text-xs font-bold uppercase ${c==="write"?"text-brand border-b-2 border-brand bg-brand/5":"opacity-60 hover:opacity-100"}`,children:"Write"}),e.jsxs("button",{onClick:()=>x("blocks"),className:`flex-1 py-3 text-xs font-bold uppercase ${c==="blocks"?"text-brand border-b-2 border-brand bg-brand/5":"opacity-60 hover:opacity-100"}`,children:["Blocks (",d.length,")"]})]}),c==="write"&&e.jsxs("div",{className:"flex-1 flex flex-col p-4 bg-bg",children:[e.jsx("textarea",{className:"flex-1 w-full bg-transparent resize-none outline-none font-serif text-base leading-relaxed placeholder:opacity-30",placeholder:`Type your sermon notes, thoughts, or copy/paste a document here.
When you click 'Convert', Bible references (e.g., John 3:16) will be automatically detected and extracted.`,value:o,onChange:t=>f(t.target.value)}),e.jsx("div",{className:"pt-4 flex justify-end",children:e.jsxs("button",{onClick:w,disabled:!o.trim(),className:"px-6 py-3 bg-brand text-white font-bold text-sm rounded shadow hover:opacity-90 disabled:opacity-50 transition-all flex items-center gap-2",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M19.428 15.428a2 2 0 00-1.022-.547l-2.387-.477a6 6 0 00-3.86.517l-.318.158a6 6 0 01-3.86.517L6.05 15.21a2 2 0 00-1.806.547M8 4h8l-1 1v5.172a2 2 0 00.586 1.414l5 5c1.26 1.26.367 3.414-1.415 3.414H4.828c-1.782 0-2.674-2.154-1.414-3.414l5-5A2 2 0 009 10.172V5L8 4z"})}),"Convert to SuperNote"]})})]}),c==="blocks"&&e.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-3 bg-bg/50",children:[d.length===0?e.jsxs("div",{className:"h-full flex flex-col items-center justify-center opacity-30 text-center",children:[e.jsx("p",{children:"No blocks yet."}),e.jsx("button",{onClick:()=>x("write"),className:"text-brand hover:underline",children:"Write something"})]}):d.map((t,r)=>e.jsxs("div",{className:"group flex items-start gap-2 p-3 bg-card border border-border rounded-lg hover:border-brand/50 transition-colors",children:[e.jsxs("div",{className:"flex flex-col gap-1 pt-1 opacity-20 group-hover:opacity-100",children:[e.jsx("button",{onClick:()=>u(r,-1),disabled:r===0,className:"hover:text-brand disabled:opacity-10",children:"▲"}),e.jsx("button",{onClick:()=>u(r,1),disabled:r===d.length-1,className:"hover:text-brand disabled:opacity-10",children:"▼"})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[t.type==="heading"&&e.jsx("div",{className:"font-bold text-brand border-b border-brand/20 pb-1",children:t.content}),t.type==="text"&&e.jsx("div",{className:"whitespace-pre-wrap opacity-80 text-sm font-serif",children:t.content}),t.type==="ref"&&e.jsxs("div",{className:"flex items-center gap-2 font-bold text-sm bg-brand/10 text-brand w-fit px-3 py-1.5 rounded-full",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.246 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"})}),t.ref]})]}),e.jsx("button",{onClick:()=>j(r),className:"text-red-400 opacity-20 group-hover:opacity-100 hover:bg-red-500/10 p-2 rounded",children:"×"})]},t.id)),e.jsxs("div",{className:"flex justify-center gap-2 pt-4 border-t border-border/50 mt-4 opacity-50 hover:opacity-100 transition-opacity",children:[e.jsx("button",{onClick:()=>l([...d,{id:`ref_${Date.now()}`,type:"ref",ref:"Gen 1:1"}]),className:"px-3 py-1 text-xs border rounded hover:bg-card",children:"+ Verse"}),e.jsx("button",{onClick:()=>l([...d,{id:`txt_${Date.now()}`,type:"text",content:"Note..."}]),className:"px-3 py-1 text-xs border rounded hover:bg-card",children:"+ Text"}),e.jsx("button",{onClick:()=>l([...d,{id:`hdr_${Date.now()}`,type:"heading",content:"Header"}]),className:"px-3 py-1 text-xs border rounded hover:bg-card",children:"+ Header"})]})]})]})]})};export{S as CollectionEditorModal};
