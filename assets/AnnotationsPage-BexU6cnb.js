import{u as w,r as d,j as t}from"./index-Cen6tLtI.js";function S({annotations:a,getVerseText:f,onNavigateToVerse:j}){const{openModal:v}=w(),[m,N]=d.useState("newest"),[i,g]=d.useState(!0),[c,b]=d.useState(null),h=d.useMemo(()=>{const e=new Set;return a.forEach(l=>{l.color&&e.add(l.color)}),Array.from(e)},[a]),x=d.useMemo(()=>{let e=[...a];c&&(e=e.filter(s=>s.color===c)),e.sort((s,r)=>{const o=s.book.localeCompare(r.book);return o!==0?o:s.chapter!==r.chapter?s.chapter-r.chapter:s.verse-r.verse});const l=[];if(e.length>0){let s=[e[0]];for(let r=1;r<e.length;r++){const o=s[s.length-1],n=e[r],u=n.book===o.book&&n.chapter===o.chapter&&n.verse===o.verse+1,y=n.color===o.color;u&&y?s.push(n):(l.push(p(s)),s=[n])}l.push(p(s))}return l.sort((s,r)=>{switch(m){case"newest":return r.updatedAt-s.updatedAt;case"oldest":return s.updatedAt-r.updatedAt;case"book":const o=s.book.localeCompare(r.book);return o!==0?o:s.chapter-r.chapter||s.startVerse-r.startVerse;case"color":return(s.color||"").localeCompare(r.color||"");default:return 0}}),l},[a,m,c]);function p(e){const s=e.map(o=>o.note).filter(o=>o&&o.trim().length>0).join(`

`),r=Math.max(...e.map(o=>o.updatedAt));return{id:e[0].id,annotations:e,color:e[0].color,book:e[0].book,chapter:e[0].chapter,startVerse:e[0].verse,endVerse:e[e.length-1].verse,updatedAt:r,mergedNote:s}}const k=(e,l)=>{l.stopPropagation();const s=e.startVerse!==e.endVerse,r=`${e.book} ${e.chapter}:${e.startVerse}${s?"-"+e.endVerse:""}`,o=e.annotations.length===1?e.id:void 0;let n=e.mergedNote;!o&&n&&!n.trim().startsWith("#")&&(n=`##### ${n.trim()}`),v("ADD_TO_SUPERNOTE",{content:{reference:r,note:n,annotationId:o},onSuccess:u=>{}})};return t.jsxs("div",{className:"min-h-screen bg-bg text-text p-2 sm:p-6 max-w-5xl mx-auto font-sans animate-in fade-in duration-300 pt-20",children:[t.jsx("div",{className:"flex items-center justify-between mb-6 border-b border-border pb-4",children:t.jsxs("div",{children:[t.jsx("h1",{className:"text-2xl sm:text-3xl font-serif font-bold text-brand",children:"My Annotations"}),t.jsxs("p",{className:"text-sm opacity-60",children:[x.length," entries found",x.length!==a.length&&` (merged from ${a.length} verses)`]})]})}),t.jsxs("div",{className:"mb-6 flex flex-col sm:flex-row gap-4 justify-between bg-card p-4 rounded-lg border border-border",children:[t.jsxs("div",{className:"flex flex-wrap gap-4 items-center",children:[t.jsxs("div",{className:"flex flex-col gap-1",children:[t.jsx("label",{className:"text-[10px] uppercase font-bold opacity-50",children:"Sort Order"}),t.jsxs("select",{value:m,onChange:e=>N(e.target.value),className:"bg-bg border border-border rounded p-1.5 text-sm focus:border-brand outline-none",children:[t.jsx("option",{value:"newest",children:"Newest First"}),t.jsx("option",{value:"oldest",children:"Oldest First"}),t.jsx("option",{value:"book",children:"Book (A-Z)"}),t.jsx("option",{value:"color",children:"Color Group"})]})]}),t.jsxs("div",{className:"flex flex-col gap-1",children:[t.jsx("label",{className:"text-[10px] uppercase font-bold opacity-50",children:"Content"}),t.jsx("button",{onClick:()=>g(!i),className:`px-3 py-1.5 rounded border text-sm font-bold transition-colors ${i?"bg-brand text-white border-brand":"bg-bg border-border text-text"}`,children:i?"Hide Scripture":"Show Scripture"})]})]}),h.length>0&&t.jsxs("div",{className:"flex flex-col gap-1",children:[t.jsx("label",{className:"text-[10px] uppercase font-bold opacity-50",children:"Filter by Color"}),t.jsxs("div",{className:"flex gap-2 items-center",children:[t.jsx("button",{onClick:()=>b(null),className:`w-6 h-6 rounded-full border flex items-center justify-center ${c===null?"border-brand ring-1 ring-brand":"border-border bg-bg"}`,title:"All",children:t.jsx("span",{className:"text-xs font-bold opacity-50",children:"All"})}),h.map(e=>t.jsx("button",{onClick:()=>b(e===c?null:e),className:`w-6 h-6 rounded-full border shadow-sm transition-transform ${c===e?"scale-125 border-text":"border-transparent"}`,style:{backgroundColor:e}},e))]})]})]}),t.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:x.length===0?t.jsx("div",{className:"col-span-full text-center py-12 opacity-50 italic border-2 border-dashed border-border rounded-xl",children:"No annotations match your criteria."}):x.map(e=>{const l=e.startVerse!==e.endVerse,s=`${e.book} ${e.chapter}:${e.startVerse}${l?"-"+e.endVerse:""}`;return t.jsxs("div",{onClick:()=>j(e.book,e.chapter,e.startVerse),className:"bg-card border border-border rounded-lg p-4 hover:border-brand cursor-pointer group transition-all relative",children:[t.jsxs("div",{className:"flex justify-between items-start mb-2",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[e.color&&t.jsx("div",{className:"w-3 h-3 rounded-full shrink-0",style:{backgroundColor:e.color}}),t.jsx("h3",{className:"font-bold text-brand font-serif",children:s})]}),t.jsx("span",{className:"text-[10px] opacity-40 font-mono",children:new Date(e.updatedAt).toLocaleDateString()})]}),i&&t.jsx("div",{className:"mb-3 p-2 bg-bg/50 rounded border-l-2 border-brand/50 text-sm font-serif italic opacity-80 space-y-2",children:e.annotations.map(r=>t.jsxs("div",{className:"block",children:[t.jsx("sup",{className:"text-[0.6em] mr-1 opacity-60 font-bold",children:r.verse}),f(r.book,r.chapter,r.verse)]},r.verse))}),e.mergedNote?t.jsx("p",{className:"text-sm opacity-90 leading-relaxed whitespace-pre-wrap mb-4",children:e.mergedNote}):t.jsx("p",{className:"text-xs opacity-40 italic mb-4",children:"No additional note."}),t.jsx("div",{className:"border-t border-border pt-2 flex justify-end",children:t.jsxs("button",{onClick:r=>k(e,r),className:"text-xs font-bold uppercase flex items-center gap-1 opacity-60 hover:opacity-100 hover:text-brand transition-all",children:[t.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M12 9v3m0 0v3m0-3h3m-3 0H9m12 0a9 9 0 11-18 0 9 9 0 0118 0z"})}),"Add to SuperNote"]})})]},e.id)})}),t.jsx("div",{className:"mt-8 text-center",children:t.jsx("p",{className:"text-xs opacity-30",children:"End of list"})})]})}export{S as AnnotationsPage};
