import{R as D,u as z,r as R,j as e,d as h,p as P,g as U}from"./index-Cen6tLtI.js";const V=D.memo(({translations:d,state:s,dispatch:l,onLoadData:i,showStatus:r,activeTranslationId:n})=>{const{openModal:j}=z(),[y,x]=R.useState(null),[C,N]=R.useState(""),f=async m=>{if(m.target.files&&m.target.files[0]){l({type:"SET_PROCESSING",payload:!0});const A=m.target.files[0],a=new FileReader;a.onload=async c=>{var t;const g=(t=c.target)==null?void 0:t.result;await w(g,A.name),l({type:"SET_PROCESSING",payload:!1})},a.readAsText(A)}},w=async(m,A,a)=>{try{const c=P(m,A);if(!c)throw new Error("Failed to parse XML");if(d.find(u=>u.id===c.translationId)&&!confirm(`Translation "${c.displayName}" already exists. Overwrite?`))return;const t={id:c.translationId,displayName:c.displayName,verses:c.verses,sourceUrl:a};await h.saveTranslation(t),await i(),r(`Installed: ${c.displayName}`)}catch(c){console.error(c),r("Failed to import Bible.",!0)}},T=m=>{j("CONFIRMATION",{title:"Delete Bible?",message:"Are you sure you want to remove this translation?",isDangerous:!0,onConfirm:async()=>{await h.deleteTranslation(m),await i(),r("Deleted translation.")}})},I=async()=>{if(y&&C.trim())try{await h.updateTranslation(y,{displayName:C.trim()}),await i(),x(null),r("Renamed successfully.")}catch{r("Failed to rename.",!0)}},_=()=>{j("REPO_IMPORT",{onImport:async(m,A)=>{try{const c=await(await fetch(m)).text();await w(c,A,m)}catch{r(`Failed to download ${A}`,!0)}}})};return e.jsx("div",{className:"space-y-8 animate-in fade-in",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between gap-4 border-b border-border pb-2",children:[e.jsx("h2",{className:"text-lg font-bold uppercase tracking-wider opacity-80",children:"Installed Bibles"}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:_,className:"text-xs font-bold uppercase tracking-wider hover:text-brand transition-colors",children:"Download Online"}),e.jsxs("label",{className:"text-xs font-bold uppercase tracking-wider hover:text-brand cursor-pointer transition-colors",children:["Import XML",e.jsx("input",{type:"file",accept:".xml",className:"hidden",onChange:f})]})]})]}),e.jsx("div",{className:"divide-y divide-border/50",children:d.length===0?e.jsx("div",{className:"py-8 text-center opacity-50 italic",children:"No Bibles installed. Import an XML file or download one."}):d.map(m=>e.jsxs("div",{className:"py-4 flex justify-between items-center group",children:[e.jsxs("div",{className:"min-w-0 pr-4",children:[y===m.id?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"text",value:C,onChange:A=>N(A.target.value),className:"bg-bg border border-border rounded px-2 py-1 text-sm font-bold focus:border-brand outline-none",autoFocus:!0}),e.jsx("button",{onClick:I,className:"text-green-500 hover:text-green-400",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M5 13l4 4L19 7"})})}),e.jsx("button",{onClick:()=>x(null),className:"text-red-400 hover:text-red-500",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M6 18L18 6M6 6l12 12"})})})]}):e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"font-bold text-lg",children:m.displayName}),m.id===n&&e.jsx("span",{className:"text-[10px] bg-brand/20 text-brand px-1.5 py-0.5 rounded font-bold uppercase",children:"Active"})]}),e.jsxs("div",{className:"text-xs opacity-50 font-mono mt-1 truncate",children:[m.id," • ",m.verses.length," verses"]})]}),e.jsxs("div",{className:"flex items-center gap-3 opacity-60 group-hover:opacity-100 transition-opacity",children:[!y&&e.jsx("button",{onClick:()=>{x(m.id),N(m.displayName)},className:"p-2 hover:bg-card rounded-full text-text hover:text-brand transition-colors",title:"Rename",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"})})}),e.jsx("button",{onClick:()=>T(m.id),className:"p-2 hover:bg-red-500/10 rounded-full text-red-400 hover:text-red-500 transition-colors",title:"Delete",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]})]},m.id))})]})})});function W(d,s){try{const l=JSON.parse(d),i=[];let r=0;for(const[n,j]of Object.entries(l))if(Array.isArray(j)){const y=j.filter(x=>typeof x=="string");y.length>0&&(i.push({dayIndex:r,references:y,completed:!1}),r++)}return i.length===0?null:{id:`plan_${Date.now()}`,title:s||"Imported Plan",days:i,currentDayIndex:0,createdAt:Date.now()}}catch(l){return console.error("Failed to parse plan",l),null}}const J=D.memo(({collections:d,plans:s,hasTSK:l,onLoadData:i,showStatus:r,onEditCollection:n,onMemorizeCollection:j,dispatch:y})=>{const{openModal:x}=z(),[C,N]=R.useState(null),[f,w]=R.useState(""),T=t=>{if(t.target.files&&t.target.files[0]){const u=t.target.files[0];y({type:"SET_PROCESSING",payload:!0});const p=new FileReader;p.onload=async k=>{var O;try{const v=(O=k.target)==null?void 0:O.result,$=JSON.parse(v),M=[],F=500;for(const[o,b]of Object.entries($)){const E=o.split(",");if(E.length===3){const S=parseInt(E[0],10),L=U(S);L&&M.push({id:`${L}_${E[1]}_${E[2]}`,entries:b})}}for(let o=0;o<M.length;o+=F){const b=M.slice(o,o+F);await h.saveTSKBatch(b)}await i(),r(`Imported TSK (${M.length} entries).`)}catch{r("Failed to import TSK JSON.",!0)}finally{y({type:"SET_PROCESSING",payload:!1})}},p.readAsText(u)}},I=t=>{if(t.target.files&&t.target.files[0]){const u=t.target.files[0],p=new FileReader;p.onload=async k=>{var O;try{const v=(O=k.target)==null?void 0:O.result,$=u.name.replace(/\.[^/.]+$/,""),M=W(v,$);if(M)await h.savePlan(M),await i(),r(`Imported plan "${M.title}".`);else throw new Error}catch{r("Failed to import plan.",!0)}},p.readAsText(u)}},_=async t=>{x("CONFIRMATION",{title:"Delete Plan?",message:"Are you sure you want to remove this reading plan?",isDangerous:!0,onConfirm:async()=>{await h.deletePlan(t),await i(),r("Deleted plan.")}})},m=async t=>{x("CONFIRMATION",{title:"Delete SuperNote?",message:`Are you sure you want to delete "${t}"?`,isDangerous:!0,onConfirm:async()=>{await h.deleteCollection(t),await i(),r(`Deleted "${t}".`)}})},A=async()=>{if(C&&f.trim()&&f.trim()!==C)try{await h.renameCollection(C,f.trim()),await i(),N(null),r("Renamed successfully.")}catch(t){r(t.message||"Rename failed.",!0)}else N(null)},a=t=>{if(t.target.files&&t.target.files[0]){const u=t.target.files[0],p=new FileReader;p.onload=async k=>{var O;try{const v=JSON.parse((O=k.target)==null?void 0:O.result);if(v.name)await h.saveCollection(v),await i(),r(`Imported "${v.name}".`);else throw new Error}catch{r("Invalid JSON.",!0)}},p.readAsText(u)}},c=t=>{const u="data:text/json;charset=utf-8,"+encodeURIComponent(JSON.stringify(t,null,2)),p=document.createElement("a");p.setAttribute("href",u),p.setAttribute("download",`${t.name.replace(/\s+/g,"_")}.json`),document.body.appendChild(p),p.click(),p.remove()},g=t=>{x("COLLECTION_EDITOR",{collection:t,onSave:async()=>{await i(),r(t?"SuperNote updated.":"SuperNote created.")}})};return e.jsxs("div",{className:"space-y-8 animate-in fade-in",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between gap-4 border-b border-border pb-2",children:[e.jsx("h2",{className:"text-lg font-bold uppercase tracking-wider opacity-80",children:"Reading Plans"}),e.jsxs("label",{className:"text-xs font-bold uppercase tracking-wider hover:text-brand cursor-pointer transition-colors",children:["Import JSON",e.jsx("input",{type:"file",accept:".json",className:"hidden",onChange:I})]})]}),e.jsx("div",{className:"divide-y divide-border/50",children:s.length===0?e.jsx("div",{className:"py-4 opacity-50 text-sm italic",children:"No plans."}):s.map(t=>{const u=Math.round(t.days.filter(p=>p.completed).length/t.days.length*100);return e.jsxs("div",{className:"py-4 flex justify-between items-center group",children:[e.jsxs("div",{className:"w-full sm:w-auto pr-4",children:[e.jsx("div",{className:"font-bold text-sm",children:t.title}),e.jsx("div",{className:"w-full sm:w-48 h-1 bg-border rounded-full mt-2 overflow-hidden",children:e.jsx("div",{className:"h-full bg-brand",style:{width:`${u}%`}})})]}),e.jsx("button",{onClick:()=>_(t.id),className:"text-xs text-red-400 font-bold opacity-0 group-hover:opacity-100 transition-opacity",children:"Delete"})]},t.id)})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between gap-4 border-b border-border pb-2",children:[e.jsx("h2",{className:"text-lg font-bold uppercase tracking-wider opacity-80",children:"My SuperNotes"}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>g(null),className:"text-xs font-bold uppercase tracking-wider hover:text-brand transition-colors",children:"Create New"}),e.jsxs("label",{className:"text-xs font-bold uppercase tracking-wider hover:text-brand cursor-pointer transition-colors",children:["Import JSON",e.jsx("input",{type:"file",accept:".json",className:"hidden",onChange:a})]})]})]}),e.jsx("div",{className:"divide-y divide-border/50",children:d.length===0?e.jsx("div",{className:"py-4 opacity-50 text-sm italic",children:"No SuperNotes. Create one to extract verses."}):d.map(t=>{var u;return e.jsxs("div",{className:"py-4 flex flex-col sm:flex-row justify-between items-start sm:items-center gap-3 group",children:[e.jsx("div",{className:"flex-1 min-w-0",children:C===t.name?e.jsxs("div",{className:"flex items-center gap-2 max-w-xs",children:[e.jsx("input",{type:"text",value:f,onChange:p=>w(p.target.value),className:"bg-bg border border-border rounded px-2 py-1 text-sm font-bold focus:border-brand outline-none w-full",autoFocus:!0}),e.jsx("button",{onClick:A,className:"text-green-500 hover:text-green-400",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M5 13l4 4L19 7"})})}),e.jsx("button",{onClick:()=>N(null),className:"text-red-400 hover:text-red-500",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M6 18L18 6M6 6l12 12"})})})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"font-bold text-sm truncate",children:t.name}),e.jsx("button",{onClick:()=>{N(t.name),w(t.name)},className:"opacity-0 group-hover:opacity-50 hover:!opacity-100 transition-opacity p-1",title:"Rename",children:e.jsx("svg",{className:"w-3 h-3 text-brand",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"})})})]}),e.jsxs("div",{className:"text-xs opacity-50 mt-0.5",children:[t.items?t.items.length:((u=t.verses)==null?void 0:u.length)||0," blocks"]})]})}),e.jsxs("div",{className:"flex gap-3 opacity-60 group-hover:opacity-100 transition-opacity items-center",children:[e.jsx("button",{onClick:()=>j(t.name),className:"text-xs font-bold hover:text-brand transition-colors",children:"Memorize"}),e.jsx("button",{onClick:()=>c(t),className:"text-xs font-bold hover:text-text transition-colors",children:"Export"}),e.jsx("button",{onClick:()=>g(t),className:"text-xs font-bold hover:text-text transition-colors",children:"Edit Content"}),e.jsx("button",{onClick:()=>m(t.name),className:"text-xs font-bold text-red-400 hover:text-red-500 transition-colors",children:"Delete"})]})]},t.name)})})]}),e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"flex items-center justify-between gap-4 border-b border-border pb-2",children:[e.jsx("h2",{className:"text-lg font-bold uppercase tracking-wider opacity-80",children:"Commentaries (TSK)"}),e.jsxs("label",{className:`text-xs font-bold uppercase tracking-wider cursor-pointer transition-colors ${l?"text-green-500 cursor-default":"hover:text-brand"}`,children:[l?"Installed ✓":"Import JSON",e.jsx("input",{type:"file",accept:".json",className:"hidden",onChange:T,disabled:l})]})]})})]})}),K=D.memo(({visuals:d,audioFiles:s,state:l,dispatch:i,onLoadData:r,showStatus:n})=>{const{openModal:j}=z(),[y,x]=D.useState(!1),C=a=>{if(a.target.files&&a.target.files[0]){x(!0);const c=a.target.files[0],g=new FileReader;g.onload=async t=>{var p;const u={id:`vis_${Date.now()}`,name:c.name,data:(p=t.target)==null?void 0:p.result,mimeType:c.type,createdAt:Date.now()};try{await h.saveVisual(u),await r(),n(`Added image "${c.name}"`)}catch{n("Failed.",!0)}finally{x(!1)}},g.readAsDataURL(c)}},N=async()=>{x(!0);try{const a=Math.floor(Math.random()*1e3),g=await(await fetch(`https://picsum.photos/seed/${a}/1920/1080`)).blob(),t=new FileReader;t.onload=async u=>{var k;const p={id:`vis_${Date.now()}`,name:`Nature ${a}`,data:(k=u.target)==null?void 0:k.result,mimeType:g.type,source:"Picsum",createdAt:Date.now()};await h.saveVisual(p),await r(),n("Downloaded background"),x(!1)},t.readAsDataURL(g)}catch{x(!1),n("Failed",!0)}},f=async a=>{confirm("Delete?")&&(await h.deleteVisual(a),await r(),n("Deleted"))},w=(a,c)=>{if(a.target.files&&a.target.files[0]){x(!0);const g=a.target.files[0],t=new FileReader;t.onload=async u=>{var k;const p={id:`aud_${Date.now()}`,name:g.name.replace(/\.[^/.]+$/,""),category:c,data:(k=u.target)==null?void 0:k.result,mimeType:g.type,createdAt:Date.now()};try{await h.saveAudio(p),await r(),n(`Added ${c.toUpperCase()}: ${p.name}`)}catch{n("Failed to save audio.",!0)}finally{x(!1)}},t.readAsDataURL(g)}},T=async a=>{confirm("Delete this audio file?")&&(await h.deleteAudio(a),await r(),n("Deleted."))},I=async a=>{try{if(a.url.startsWith("data:")){const c={id:`aud_${Date.now()}`,name:a.name,category:a.category,data:a.url,mimeType:a.url.split(";")[0].split(":")[1],createdAt:Date.now()};await h.saveAudio(c)}else{const c=await fetch(a.url);if(!c.ok)throw new Error("Download failed");const g=await c.blob(),t=new FileReader;await new Promise((u,p)=>{t.onload=async k=>{var $;const O=($=k.target)==null?void 0:$.result,v={id:`aud_${Date.now()}`,name:a.name,category:a.category,data:O,mimeType:g.type,createdAt:Date.now()};await h.saveAudio(v),u(null)},t.onerror=p,t.readAsDataURL(g)})}await r(),n(`Downloaded ${a.name}`)}catch{n(`Failed to download ${a.name}`,!0)}},_=()=>{j("AUDIO_LIBRARY",{onImport:I})},m=s.filter(a=>a.category==="bgm"),A=s.filter(a=>a.category==="sfx");return e.jsxs("div",{className:"space-y-8 animate-in fade-in",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between gap-4 border-b border-border pb-2",children:[e.jsx("h2",{className:"text-lg font-bold uppercase tracking-wider opacity-80",children:"Background Images"}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:N,disabled:y,className:"text-xs font-bold uppercase tracking-wider hover:text-brand transition-colors disabled:opacity-50",children:y?"...":"Random"}),e.jsxs("label",{className:"text-xs font-bold uppercase tracking-wider hover:text-brand cursor-pointer transition-colors",children:["Upload",e.jsx("input",{type:"file",accept:"image/*",className:"hidden",onChange:C,disabled:y})]})]})]}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:d.length===0?e.jsx("div",{className:"col-span-full py-8 text-center opacity-50 text-sm italic",children:"No images."}):d.map(a=>e.jsxs("div",{className:"relative group aspect-video bg-black/20 overflow-hidden",children:[e.jsx("img",{src:a.data,alt:a.name,className:"w-full h-full object-cover opacity-80 group-hover:opacity-100 transition-opacity"}),e.jsx("div",{className:"absolute inset-0 flex items-end justify-end p-2 opacity-0 group-hover:opacity-100 transition-opacity bg-gradient-to-t from-black/50 to-transparent",children:e.jsx("button",{onClick:()=>f(a.id),className:"text-red-400 text-xs font-bold uppercase",children:"Delete"})})]},a.id))})]}),e.jsxs("div",{className:"space-y-4 pt-4",children:[e.jsxs("div",{className:"flex items-center justify-between gap-4 border-b border-border pb-2",children:[e.jsx("h2",{className:"text-lg font-bold uppercase tracking-wider opacity-80",children:"Background Music"}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:_,className:"text-xs font-bold uppercase tracking-wider hover:text-brand transition-colors",children:"Online"}),e.jsxs("label",{className:"text-xs font-bold uppercase tracking-wider hover:text-brand cursor-pointer transition-colors",children:["Upload",e.jsx("input",{type:"file",accept:"audio/*",className:"hidden",onChange:a=>w(a,"bgm"),disabled:y})]})]})]}),e.jsx("div",{className:"divide-y divide-border/50",children:m.length===0?e.jsx("div",{className:"py-4 text-center opacity-50 text-sm italic",children:"No background music."}):m.map(a=>e.jsxs("div",{className:"py-3 flex justify-between items-center group",children:[e.jsx("div",{className:"flex items-center gap-3",children:e.jsx("div",{className:"font-bold text-sm",children:a.name})}),e.jsxs("div",{className:"flex items-center gap-2 opacity-60 group-hover:opacity-100 transition-opacity",children:[e.jsx("audio",{src:a.data,controls:!0,className:"h-6 w-32"}),e.jsx("button",{onClick:()=>T(a.id),className:"text-red-400 text-xs font-bold uppercase ml-2 hover:text-red-500",children:"Delete"})]})]},a.id))})]}),e.jsxs("div",{className:"space-y-4 pt-4",children:[e.jsxs("div",{className:"flex items-center justify-between gap-4 border-b border-border pb-2",children:[e.jsx("h2",{className:"text-lg font-bold uppercase tracking-wider opacity-80",children:"Sound Effects"}),e.jsxs("label",{className:"text-xs font-bold uppercase tracking-wider hover:text-brand cursor-pointer transition-colors",children:["Upload",e.jsx("input",{type:"file",accept:"audio/*",className:"hidden",onChange:a=>w(a,"sfx"),disabled:y})]})]}),e.jsx("div",{className:"divide-y divide-border/50",children:A.length===0?e.jsx("div",{className:"py-4 text-center opacity-50 text-sm italic",children:"No sound effects."}):A.map(a=>e.jsxs("div",{className:"py-3 flex justify-between items-center group",children:[e.jsx("div",{className:"font-bold text-sm",children:a.name}),e.jsxs("div",{className:"flex items-center gap-2 opacity-60 group-hover:opacity-100 transition-opacity",children:[e.jsx("button",{onClick:()=>new Audio(a.data).play(),className:"text-xs font-bold uppercase hover:text-brand",children:"Preview"}),e.jsx("button",{onClick:()=>T(a.id),className:"text-red-400 text-xs font-bold uppercase ml-2 hover:text-red-500",children:"Delete"})]})]},a.id))})]})]})}),G=new Set(["the","and","of","to","in","a","that","is","he","for","it","was","his","with","as","are","not","be","but","on","they","shall","at","him","my","me","have","thou","from","thy","all","by","this","unto","which","man","god","lord","israel","son","king","people","house","came","one","out","her","she","there","their","when","up","down","said","saying","then","we","us","you","your","ye","or","if","do","did","so","an","what","who","them","see","go","come","now","no","like","into","can","will","may","upon","over","before","after"]),X=D.memo(({collections:d,translations:s,showStatus:l,activeTranslationId:i,activeToolTab:r,setActiveToolTab:n,selectedToolCollection:j,setSelectedToolCollection:y})=>{const[x,C]=D.useState(new Set),[N,f]=D.useState(new Set),[w,T]=D.useState(""),[I,_]=D.useState(50),[m,A]=D.useState("blank"),[a,c]=D.useState(0),[g,t]=D.useState("book"),[u,p]=D.useState(""),[k,O]=D.useState([]),v=R.useMemo(()=>s.find(o=>o.id===i)||s[0],[s,i]),$=()=>{if(x.size===0||N.size===0)return;const o=d.filter(S=>x.has(S.name)),b=s.filter(S=>N.has(S.id));let E="";o.forEach(S=>{E+=`SUPERNOTE: ${S.name}

`,S.items.forEach(L=>{L.type==="ref"&&L.ref&&(E+=`${L.ref}
`,b.forEach(B=>{E+=`[${B.displayName}] (Verse content placeholder)
`}),E+=`
`)})}),T(E)},M=R.useMemo(()=>d.find(o=>o.name===j),[d,j]);R.useMemo(()=>!M||!v?[]:(M.items.filter(b=>b.type==="ref"&&b.ref).map(b=>null),[]),[M,I,a,v]);const F=()=>{let o=[];if(!v){l("No Bible installed",!0);return}if(g==="book"&&(o=v.verses.filter(S=>S._book===u)),o.length===0){O([]),l("No text found to analyze.");return}const b={};o.forEach(S=>{S.text.toLowerCase().replace(/[.,/#!$%^&*;:{}=\-_`~()]/g,"").split(/\s+/).forEach(B=>{B&&!G.has(B)&&B.length>2&&(b[B]=(b[B]||0)+1)})});const E=Object.entries(b).map(([S,L])=>({word:S,count:L})).sort((S,L)=>L.count-S.count).slice(0,50);O(E)};return e.jsxs("div",{className:"flex flex-col h-full gap-6 animate-in fade-in",children:[e.jsxs("div",{className:"flex gap-4 border-b border-border/50 pb-2 overflow-x-auto",children:[e.jsx("button",{onClick:()=>n("compiler"),className:`text-xs font-bold uppercase tracking-wider whitespace-nowrap hover:text-brand ${r==="compiler"?"text-brand":"opacity-60"}`,children:"Compiler"}),e.jsx("button",{onClick:()=>n("memorize"),className:`text-xs font-bold uppercase tracking-wider whitespace-nowrap hover:text-brand ${r==="memorize"?"text-brand":"opacity-60"}`,children:"Memorize"}),e.jsx("button",{onClick:()=>n("analyze"),className:`text-xs font-bold uppercase tracking-wider whitespace-nowrap hover:text-brand ${r==="analyze"?"text-brand":"opacity-60"}`,children:"Analyze"})]}),r==="compiler"&&e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 h-64",children:[e.jsxs("div",{className:"flex-1 overflow-y-auto",children:[e.jsx("div",{className:"text-xs font-bold uppercase opacity-50 mb-2",children:"SuperNotes"}),d.map(o=>e.jsxs("label",{className:"flex gap-2 text-xs py-1 hover:text-brand cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:x.has(o.name),onChange:()=>{const b=new Set(x);b.has(o.name)?b.delete(o.name):b.add(o.name),C(b)},className:"accent-brand"}),o.name]},o.name))]}),e.jsxs("div",{className:"flex-1 overflow-y-auto",children:[e.jsx("div",{className:"text-xs font-bold uppercase opacity-50 mb-2",children:"Translations"}),s.map(o=>e.jsxs("label",{className:"flex gap-2 text-xs py-1 hover:text-brand cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:N.has(o.id),onChange:()=>{const b=new Set(N);b.has(o.id)?b.delete(o.id):b.add(o.id),f(b)},className:"accent-brand"}),o.displayName]},o.id))]})]}),e.jsx("button",{onClick:$,className:"bg-brand text-white font-bold py-2 rounded text-sm hover:opacity-90",children:"Compile Output"}),e.jsx("textarea",{readOnly:!0,value:w,className:"h-40 bg-black/10 p-4 font-mono text-xs resize-none rounded",placeholder:"Output will appear here..."})]}),r==="memorize"&&e.jsx("div",{className:"flex flex-col gap-6",children:e.jsx("div",{className:"text-center opacity-50 py-10",children:"Memorize tool is being updated to support SuperNotes. Check back soon."})}),r==="analyze"&&e.jsxs("div",{className:"flex flex-col gap-6",children:[e.jsxs("div",{className:"flex flex-wrap gap-4 items-center border-b border-border/50 pb-4",children:[e.jsx("div",{className:"flex gap-2",children:e.jsx("button",{onClick:()=>t("book"),className:`text-xs font-bold uppercase ${g==="book"?"text-brand":"opacity-60"}`,children:"Book"})}),e.jsxs("select",{value:u,onChange:o=>p(o.target.value),className:"bg-bg border-b border-border px-2 py-1 text-sm font-bold focus:border-brand outline-none flex-1 max-w-xs",children:[e.jsx("option",{value:"",disabled:!0,children:"Select Target"}),Array.from(new Set(v==null?void 0:v.verses.map(o=>o._book))).map(o=>e.jsx("option",{value:o,children:o},o))]}),e.jsx("button",{onClick:F,className:"text-xs font-bold uppercase bg-brand text-white px-3 py-1 rounded hover:opacity-90",children:"Run"})]}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:k.length===0?e.jsx("div",{className:"text-center opacity-50 text-sm mt-10 italic",children:"Select source and run analysis."}):e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-4",children:k.map((o,b)=>e.jsxs("div",{className:"flex justify-between items-center border-b border-border/30 pb-1",children:[e.jsx("span",{className:"font-bold text-sm capitalize",children:o.word}),e.jsx("span",{className:"text-xs font-mono opacity-60",children:o.count})]},b))})})]})]})}),q=({dispatch:d,showStatus:s})=>{const{openModal:l}=z(),[i,r]=R.useState(null),[n,j]=R.useState(!1),y=async()=>{const f=await h.getStorageEstimate();if(f){const w=T=>(T/1048576).toFixed(1);r({usage:w(f.usage),quota:w(f.quota),percent:Math.min(100,f.usage/f.quota*100)})}};R.useEffect(()=>{y()},[]);const x=async()=>{try{const f=await h.exportFullDatabase(),w=new Blob([f],{type:"application/json"}),T=URL.createObjectURL(w),I=document.createElement("a");I.href=T,I.download=`divine_words_backup_${new Date().toISOString().slice(0,10)}.json`,I.click(),URL.revokeObjectURL(T),s("Backup generated successfully.")}catch{s("Backup failed.",!0)}},C=f=>{if(f.target.files&&f.target.files[0]){const w=f.target.files[0];l("CONFIRMATION",{title:"Restore Backup?",message:"This will merge the backup with your current data. Existing items with the same ID will be overwritten.",isDangerous:!1,onConfirm:()=>{j(!0);const T=new FileReader;T.onload=async I=>{var _;try{await h.importFullDatabase((_=I.target)==null?void 0:_.result),await y(),s("Restore completed successfully.")}catch(m){s(m.message,!0)}finally{j(!1)}},T.readAsText(w)}})}},N=()=>{l("CONFIRMATION",{title:"Factory Reset",message:"Are you sure? This will delete ALL data including Bibles, Notes, and Settings. This cannot be undone.",isDangerous:!0,onConfirm:async()=>{await h.deleteDatabase()}})};return e.jsxs("div",{className:"space-y-8 animate-in fade-in",children:[e.jsxs("div",{className:"bg-card border border-border rounded-xl p-6",children:[e.jsxs("h3",{className:"font-bold text-lg mb-4 flex items-center gap-2",children:[e.jsx("svg",{className:"w-5 h-5 text-brand",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M4 7v10c0 2.21 3.582 4 8 4s8-1.79 8-4V7M4 7c0 2.21 3.582 4 8 4s8-1.79 8-4M4 7c0-2.21 3.582-4 8-4s8 1.79 8 4m0 5c0 2.21-3.582 4-8 4s-8-1.79-8-4"})}),"Storage Status"]}),i?e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsxs("span",{className:"opacity-70",children:[i.usage," MB used"]}),e.jsxs("span",{className:"font-mono opacity-50",children:[i.quota," MB available"]})]}),e.jsx("div",{className:"h-3 bg-bg rounded-full overflow-hidden border border-border",children:e.jsx("div",{className:`h-full transition-all duration-1000 ${i.percent>90?"bg-red-500":"bg-brand"}`,style:{width:`${i.percent}%`}})}),e.jsx("p",{className:"text-[10px] opacity-50 text-right",children:"Data stored locally in IndexedDB."})]}):e.jsx("p",{className:"text-sm opacity-50 italic",children:"Calculating storage usage..."})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-card border border-border rounded-xl p-6 flex flex-col justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-lg mb-2",children:"Manual Backup"}),e.jsx("p",{className:"text-sm opacity-60 mb-6",children:"Create a full copy of your library, notes, and settings to a local file."})]}),e.jsxs("button",{onClick:x,className:"w-full py-3 bg-brand text-white rounded-lg font-bold text-sm hover:opacity-90 transition-opacity flex items-center justify-center gap-2",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})}),"Export All Data"]})]}),e.jsxs("div",{className:"bg-card border border-border rounded-xl p-6 flex flex-col justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-lg mb-2",children:"Restore Data"}),e.jsx("p",{className:"text-sm opacity-60 mb-6",children:"Import a previously saved backup file. Existing data will be preserved where possible."})]}),e.jsxs("label",{className:`w-full py-3 border border-border rounded-lg font-bold text-sm text-center cursor-pointer hover:bg-bg transition-colors ${n?"opacity-50 cursor-not-allowed":""}`,children:[n?"Restoring...":"Select Backup File",e.jsx("input",{type:"file",accept:".json",className:"hidden",onChange:C,disabled:n})]})]})]}),e.jsxs("div",{className:"border-t border-red-500/20 pt-8 mt-4",children:[e.jsx("h3",{className:"text-red-400 font-bold text-sm uppercase tracking-wider mb-4",children:"Danger Zone"}),e.jsxs("div",{className:"flex justify-between items-center bg-red-900/10 border border-red-900/20 rounded-lg p-4",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-bold text-red-300 text-sm",children:"Factory Reset"}),e.jsx("div",{className:"text-xs text-red-400/60 mt-1",children:"Wipes local database and reloads app."})]}),e.jsx("button",{onClick:N,className:"px-4 py-2 bg-red-900/20 text-red-300 border border-red-900/50 rounded hover:bg-red-900/40 text-xs font-bold uppercase transition-colors",children:"Reset App"})]})]})]})},H={activeTab:"bibles",translations:[],collections:[],plans:[],visuals:[],audioFiles:[],hasTSK:!1,statusMsg:null,isLoadingData:!1,isProcessingImport:!1,activeToolTab:"extractor",selectedToolCollection:""};function Z(d,s){switch(s.type){case"SET_TAB":return{...d,activeTab:s.payload};case"LOAD_DATA_START":return{...d,isLoadingData:!0};case"LOAD_DATA_SUCCESS":return{...d,translations:s.payload.t,collections:s.payload.c,plans:s.payload.p,visuals:s.payload.v,audioFiles:s.payload.a,hasTSK:s.payload.tsk,isLoadingData:!1};case"SET_STATUS":return{...d,statusMsg:s.payload};case"SET_PROCESSING":return{...d,isProcessingImport:s.payload};case"SET_TOOL_TAB":return{...d,activeToolTab:s.payload};case"SET_TOOL_COLLECTION":return{...d,selectedToolCollection:s.payload};case"NAVIGATE_TO_TOOL":return{...d,activeTab:"tools",activeToolTab:s.payload.tool,selectedToolCollection:s.payload.collection||""};default:return d}}function Q({activeTranslationId:d}){const[s,l]=R.useReducer(Z,H),i=R.useCallback(async()=>{l({type:"LOAD_DATA_START"});const n=await h.getTranslations(),j=await h.getCollections(),y=await h.getPlans(),x=await h.getVisuals(),C=await h.getAudio(),N=await h.hasTSKData();l({type:"LOAD_DATA_SUCCESS",payload:{t:n,c:j,p:y,v:x,a:C,tsk:N}})},[]);R.useEffect(()=>{i()},[i]);const r=R.useCallback((n,j=!1)=>{l({type:"SET_STATUS",payload:{msg:n,error:j}}),setTimeout(()=>l({type:"SET_STATUS",payload:null}),4e3)},[]);return e.jsxs("div",{className:"min-h-screen bg-bg text-text p-4 sm:p-8 max-w-4xl mx-auto font-sans animate-in fade-in duration-300 pt-20 pb-20",children:[e.jsx("div",{className:"flex items-center justify-between mb-8 border-b border-border pb-4",children:e.jsx("h1",{className:"text-2xl font-bold",children:"Data Manager"})}),s.statusMsg&&e.jsx("div",{className:`mb-6 p-3 rounded text-sm font-semibold ${s.statusMsg.error?"bg-red-900/20 text-red-400 border border-red-900/50":"bg-green-900/20 text-green-400 border border-green-900/50"}`,children:s.statusMsg.msg}),e.jsx("div",{className:"flex gap-6 mb-8 border-b border-border/50 overflow-x-auto",children:["bibles","library","media","tools","system"].map(n=>e.jsx("button",{onClick:()=>l({type:"SET_TAB",payload:n}),className:`pb-3 font-bold text-sm uppercase tracking-wider transition-all border-b-2 whitespace-nowrap ${s.activeTab===n?"text-brand border-brand":"text-text/50 border-transparent hover:text-text"}`,children:n},n))}),e.jsxs("div",{className:"min-h-[400px]",children:[s.activeTab==="bibles"&&e.jsx(V,{translations:s.translations,state:s,dispatch:l,onLoadData:i,showStatus:r,activeTranslationId:d}),s.activeTab==="library"&&e.jsx(J,{collections:s.collections,plans:s.plans,hasTSK:s.hasTSK,onLoadData:i,showStatus:r,onEditCollection:()=>l({type:"SET_TAB",payload:"tools"}),onMemorizeCollection:n=>l({type:"NAVIGATE_TO_TOOL",payload:{tool:"memorize",collection:n}}),dispatch:l}),s.activeTab==="media"&&e.jsx(K,{visuals:s.visuals,audioFiles:s.audioFiles,state:s,dispatch:l,onLoadData:i,showStatus:r}),s.activeTab==="tools"&&e.jsx(X,{collections:s.collections,translations:s.translations,onLoadData:i,showStatus:r,onSwitchToLibrary:()=>l({type:"SET_TAB",payload:"library"}),activeTranslationId:d,activeToolTab:s.activeToolTab,setActiveToolTab:n=>l({type:"SET_TOOL_TAB",payload:n}),selectedToolCollection:s.selectedToolCollection,setSelectedToolCollection:n=>l({type:"SET_TOOL_COLLECTION",payload:n})}),s.activeTab==="system"&&e.jsx(q,{dispatch:l,showStatus:r})]})]})}export{Q as DataManager};
