import{r as p,e as u,f as m,j as e,d as y}from"./index-Cen6tLtI.js";const g=t=>({loading:!0,data:null,displayRef:t.reference,displayText:t.text});function j(t,a){switch(a.type){case"LOAD_SUCCESS":return{...t,loading:!1,data:a.payload};case"SET_VIEW":return{...t,displayRef:a.payload.ref,displayText:a.payload.text};default:return t}}const N=({verse:t,translationIndex:a,onClose:f})=>{const[o,c]=p.useReducer(j,t,g);p.useEffect(()=>{let r=!0;return(async()=>{const i=`${t._book}_${t._chapter}_${t._verse}`,d=await y.getTSK(i);r&&c({type:"LOAD_SUCCESS",payload:d||null})})(),()=>{r=!1}},[t]);const b=p.useCallback(r=>{const s=u(r);if(!s){c({type:"SET_VIEW",payload:{ref:r,text:"Could not parse reference."}});return}const i=m(s.book),d=a.get(i);if(d){const n=d.get(s.chapter);if(n){const x=n.filter(l=>l._verse>=s.startVerse&&l._verse<=s.endVerse);if(x.length>0){const l=x.map(h=>h.text).join(" ");c({type:"SET_VIEW",payload:{ref:r,text:l}});return}}}c({type:"SET_VIEW",payload:{ref:r,text:"Text not found in current translation."}})},[a]);return t?e.jsxs("div",{className:"bg-bg border border-border w-full max-w-lg rounded-xl shadow-2xl overflow-hidden flex flex-col max-h-[85vh] animate-in zoom-in-95 duration-200",children:[e.jsxs("div",{className:"flex justify-between items-center p-3 border-b border-border bg-bg shrink-0",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-[10px] font-bold uppercase tracking-widest text-brand opacity-60",children:"Cross References"}),e.jsxs("div",{className:"font-bold text-sm",children:["Source: ",t.reference]})]}),e.jsx("button",{onClick:f,className:"p-2 hover:bg-card rounded-full opacity-50 hover:opacity-100 transition-colors",children:e.jsx("span",{className:"text-xl leading-none",children:"Ã—"})})]}),e.jsxs("div",{className:"bg-card border-b-4 border-border p-4 shadow-sm shrink-0 transition-colors duration-300",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("span",{className:"text-brand font-bold text-base border-b-2 border-brand/20 pb-0.5",children:o.displayRef}),o.displayRef!==t.reference&&e.jsx("button",{onClick:()=>b(t.reference),className:"text-[10px] uppercase font-bold text-text opacity-40 hover:opacity-100 border border-border px-2 py-1 rounded hover:bg-bg",children:"Reset to Source"})]}),e.jsx("div",{className:"max-h-[150px] overflow-y-auto pr-1 custom-scrollbar",children:e.jsx("p",{className:"font-serif text-lg leading-relaxed text-text",children:o.displayText})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto bg-bg/50 p-0",children:o.loading?e.jsx("div",{className:"text-center py-10 opacity-50 text-sm",children:"Loading commentary..."}):o.data?e.jsx("div",{className:"divide-y divide-border/50",children:o.data.entries.map((r,s)=>{const[i,...d]=r;return e.jsx("div",{className:"p-3 hover:bg-black/5 transition-colors",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-20 shrink-0 pt-1.5",children:e.jsx("div",{className:"text-xs font-bold text-brand uppercase text-right leading-tight",children:i})}),e.jsx("div",{className:"flex-1 flex flex-wrap gap-1.5",children:d.map((n,x)=>{const l=o.displayRef===n;return e.jsx("button",{onClick:()=>b(n),className:`
                                                            px-2 py-1 text-xs rounded border transition-all duration-200 font-medium
                                                            ${l?"bg-brand text-white border-brand shadow-sm scale-105":"bg-card border-border hover:border-brand hover:text-brand text-text/80"}
                                                        `,children:n},x)})})]})},s)})}):e.jsx("div",{className:"text-center py-10 opacity-50 italic text-sm",children:"No cross-references found for this verse."})}),e.jsx("div",{className:"h-4 bg-gradient-to-t from-bg to-transparent pointer-events-none shrink-0"})]}):null};export{N as TSKModal};
