import{R as w,j as e,p as q,d as j,g as ee,r as M,a as ae}from"./index-C-9Ao6eb.js";const te=w.memo(({translations:n,state:t,dispatch:o,onLoadData:c,showStatus:p,activeTranslationId:d})=>{const u=async l=>{if(l.target.files&&l.target.files[0]){o({type:"SET_PROCESSING",payload:!0});const A=l.target.files[0],N=new FileReader;N.onload=async r=>{var a;const y=(a=r.target)==null?void 0:a.result;await f(y,A.name),o({type:"SET_PROCESSING",payload:!1})},N.readAsText(A)}},f=async(l,A,N)=>{const r=q(l,A);if(r){const y={id:r.translationId,displayName:r.displayName,verses:r.verses,sourceUrl:N};try{await j.saveTranslation(y),p(`Imported "${r.displayName}" successfully.`),await c()}catch{p(`Failed to save ${A}.`,!0)}}else p(`Invalid XML format for ${A}.`,!0)},S=async()=>{o({type:"SET_REPO_LOADING",payload:!0});try{const l=await fetch("https://api.github.com/repos/Beblia/Holy-Bible-XML-Format/contents");if(!l.ok)throw new Error("Failed to fetch repository.");const N=(await l.json()).filter(r=>r.name.toLowerCase().endsWith(".xml")&&r.type==="file");o({type:"SET_REPO_FILES",payload:N})}catch(l){p(l.message||"Error fetching repository.",!0),o({type:"TOGGLE_REPO_MODAL",payload:!1})}finally{o({type:"SET_REPO_LOADING",payload:!1})}},D=async l=>{var A;o({type:"START_DOWNLOAD",payload:l.name});try{const N=await fetch(l.download_url);if(!N.ok)throw new Error("Download failed");const r=(A=N.body)==null?void 0:A.getReader();if(!r){const k=await N.text();o({type:"UPDATE_PROGRESS",payload:"saving"}),await f(k,l.name,l.download_url);return}const y=+N.headers.get("Content-Length");let a=0;const x=[];for(;;){const{done:k,value:g}=await r.read();if(k)break;x.push(g),a+=g.length,y&&o({type:"UPDATE_PROGRESS",payload:Math.round(a/y*100)})}o({type:"UPDATE_PROGRESS",payload:"saving"});const b=await new Blob(x).text();await f(b,l.name,l.download_url)}catch{p(`Failed to download ${l.name}`,!0)}finally{o({type:"END_DOWNLOAD"})}},E=t.repoFiles.filter(l=>l.name.toLowerCase().includes(t.repoSearch.toLowerCase()));return e.jsxs("div",{className:"space-y-8 animate-in fade-in",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4",children:[e.jsx("h2",{className:"text-lg font-bold uppercase tracking-wider opacity-80",children:"Installed Translations"}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>{o({type:"TOGGLE_REPO_MODAL",payload:!0}),t.repoFiles.length===0&&S()},className:"text-xs font-bold uppercase tracking-wider hover:text-brand transition-colors",children:"Download Online"}),e.jsxs("label",{className:"text-xs font-bold uppercase tracking-wider hover:text-brand transition-colors cursor-pointer",children:["Import XML",e.jsx("input",{type:"file",accept:".xml",className:"hidden",onChange:u,disabled:t.isProcessingImport})]})]})]}),t.isProcessingImport&&e.jsx("p",{className:"animate-pulse text-brand text-xs font-bold uppercase",children:"Processing Local Import..."}),e.jsx("div",{className:"divide-y divide-border/50",children:n.length===0?e.jsx("div",{className:"py-8 text-center opacity-50 text-sm italic",children:"No Bibles installed."}):n.map(l=>e.jsxs("div",{className:"py-4 flex justify-between items-center group",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`font-bold text-sm ${l.id===d?"text-brand":""}`,children:l.displayName}),l.id===d&&e.jsx("span",{className:"text-[10px] bg-brand/10 text-brand px-1.5 rounded font-bold uppercase",children:"Active"})]}),e.jsxs("div",{className:"text-xs opacity-50 font-mono mt-1",children:[l.id," • ",l.verses.length," verses"]})]}),e.jsx("div",{className:"text-[10px] opacity-30 font-bold uppercase tracking-wider group-hover:opacity-100 transition-opacity",children:"Installed"})]},l.id))}),t.showRepoModal&&e.jsx("div",{className:"fixed inset-0 z-50 bg-black/50 flex items-center justify-center p-4",onClick:()=>o({type:"TOGGLE_REPO_MODAL",payload:!1}),children:e.jsxs("div",{className:"bg-bg border border-border w-full max-w-3xl flex flex-col max-h-[85vh] shadow-2xl",onClick:l=>l.stopPropagation(),children:[e.jsxs("div",{className:"p-4 border-b border-border flex justify-between items-center",children:[e.jsx("h3",{className:"font-bold text-lg",children:"Repository"}),e.jsx("button",{onClick:()=>o({type:"TOGGLE_REPO_MODAL",payload:!1}),className:"text-xl opacity-50 hover:opacity-100",children:"×"})]}),e.jsx("div",{className:"p-4 border-b border-border",children:e.jsx("input",{type:"text",placeholder:"Search repository...",className:"w-full bg-bg border-b border-border p-2 focus:border-brand focus:outline-none text-sm placeholder:opacity-30",value:t.repoSearch,onChange:l=>o({type:"SET_REPO_SEARCH",payload:l.target.value})})}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4",children:t.isRepoLoading?e.jsx("div",{className:"p-8 text-center opacity-50 text-sm",children:"Loading repository..."}):e.jsx("div",{className:"grid grid-cols-1 gap-2",children:E.map((l,A)=>e.jsxs("div",{className:"flex justify-between items-center p-2 hover:bg-white/5 transition-colors",children:[e.jsx("div",{className:"truncate pr-4",children:e.jsx("div",{className:"font-bold text-sm truncate",title:l.name,children:l.name.replace(".xml","").replace(/_/g," ")})}),e.jsx("button",{onClick:()=>D(l),disabled:!!t.downloadingFile,className:"text-xs font-bold uppercase tracking-wider text-brand hover:text-brand/80 disabled:opacity-50",children:t.downloadingFile===l.name?t.downloadProgress==="saving"?"Saving":`${t.downloadProgress}%`:"Download"})]},A))})})]})})]})});function se(n,t){try{const o=JSON.parse(n),c=[];let p=0;for(const[d,u]of Object.entries(o))if(Array.isArray(u)){const f=u.filter(S=>typeof S=="string");f.length>0&&(c.push({dayIndex:p,references:f,completed:!1}),p++)}return c.length===0?null:{id:`plan_${Date.now()}`,title:t||"Imported Plan",days:c,currentDayIndex:0,createdAt:Date.now()}}catch(o){return console.error("Failed to parse plan",o),null}}const re=w.memo(({collections:n,plans:t,hasTSK:o,onLoadData:c,showStatus:p,onEditCollection:d,onMemorizeCollection:u,dispatch:f})=>{const S=r=>{if(r.target.files&&r.target.files[0]){const y=r.target.files[0];f({type:"SET_PROCESSING",payload:!0});const a=new FileReader;a.onload=async x=>{var m;try{const b=(m=x.target)==null?void 0:m.result,k=JSON.parse(b),g=[],T=500;for(const[O,P]of Object.entries(k)){const I=O.split(",");if(I.length===3){const $=parseInt(I[0],10),F=ee($);F&&g.push({id:`${F}_${I[1]}_${I[2]}`,entries:P})}}for(let O=0;O<g.length;O+=T){const P=g.slice(O,O+T);await j.saveTSKBatch(P)}await c(),p(`Imported TSK (${g.length} entries).`)}catch{p("Failed to import TSK JSON.",!0)}finally{f({type:"SET_PROCESSING",payload:!1})}},a.readAsText(y)}},D=r=>{if(r.target.files&&r.target.files[0]){const y=r.target.files[0],a=new FileReader;a.onload=async x=>{var m;try{const b=(m=x.target)==null?void 0:m.result,k=y.name.replace(/\.[^/.]+$/,""),g=se(b,k);if(g)await j.savePlan(g),await c(),p(`Imported plan "${g.title}".`);else throw new Error}catch{p("Failed to import plan.",!0)}},a.readAsText(y)}},E=async r=>{confirm("Delete this plan?")&&(await j.deletePlan(r),await c(),p("Deleted plan."))},l=async r=>{confirm(`Delete collection "${r}"?`)&&(await j.deleteCollection(r),await c(),p(`Deleted "${r}".`))},A=r=>{if(r.target.files&&r.target.files[0]){const y=r.target.files[0],a=new FileReader;a.onload=async x=>{var m;try{const b=JSON.parse((m=x.target)==null?void 0:m.result);if(b.name&&Array.isArray(b.verses))await j.saveCollection(b),await c(),p(`Imported collection "${b.name}".`);else throw new Error}catch{p("Invalid JSON.",!0)}},a.readAsText(y)}},N=r=>{const y="data:text/json;charset=utf-8,"+encodeURIComponent(JSON.stringify(r,null,2)),a=document.createElement("a");a.setAttribute("href",y),a.setAttribute("download",`${r.name.replace(/\s+/g,"_")}.json`),document.body.appendChild(a),a.click(),a.remove()};return e.jsxs("div",{className:"space-y-8 animate-in fade-in",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between gap-4 border-b border-border pb-2",children:[e.jsx("h2",{className:"text-lg font-bold uppercase tracking-wider opacity-80",children:"Reading Plans"}),e.jsxs("label",{className:"text-xs font-bold uppercase tracking-wider hover:text-brand cursor-pointer transition-colors",children:["Import JSON",e.jsx("input",{type:"file",accept:".json",className:"hidden",onChange:D})]})]}),e.jsx("div",{className:"divide-y divide-border/50",children:t.length===0?e.jsx("div",{className:"py-4 opacity-50 text-sm italic",children:"No plans."}):t.map(r=>{const y=Math.round(r.days.filter(a=>a.completed).length/r.days.length*100);return e.jsxs("div",{className:"py-4 flex justify-between items-center group",children:[e.jsxs("div",{className:"w-full sm:w-auto pr-4",children:[e.jsx("div",{className:"font-bold text-sm",children:r.title}),e.jsx("div",{className:"w-full sm:w-48 h-1 bg-border rounded-full mt-2 overflow-hidden",children:e.jsx("div",{className:"h-full bg-brand",style:{width:`${y}%`}})})]}),e.jsx("button",{onClick:()=>E(r.id),className:"text-xs text-red-400 font-bold opacity-0 group-hover:opacity-100 transition-opacity",children:"Delete"})]},r.id)})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between gap-4 border-b border-border pb-2",children:[e.jsx("h2",{className:"text-lg font-bold uppercase tracking-wider opacity-80",children:"My Collections"}),e.jsxs("label",{className:"text-xs font-bold uppercase tracking-wider hover:text-brand cursor-pointer transition-colors",children:["Import JSON",e.jsx("input",{type:"file",accept:".json",className:"hidden",onChange:A})]})]}),e.jsx("div",{className:"divide-y divide-border/50",children:n.length===0?e.jsx("div",{className:"py-4 opacity-50 text-sm italic",children:"No collections."}):n.map(r=>e.jsxs("div",{className:"py-4 flex flex-col sm:flex-row justify-between items-start sm:items-center gap-3 group",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-bold text-sm",children:r.name}),e.jsxs("div",{className:"text-xs opacity-50 mt-0.5",children:[r.verses.length," verses"]})]}),e.jsxs("div",{className:"flex gap-3 opacity-60 group-hover:opacity-100 transition-opacity",children:[e.jsx("button",{onClick:()=>u(r.name),className:"text-xs font-bold hover:text-brand transition-colors",children:"Memorize"}),e.jsx("button",{onClick:()=>N(r),className:"text-xs font-bold hover:text-text transition-colors",children:"Export"}),e.jsx("button",{onClick:()=>d(r),className:"text-xs font-bold hover:text-text transition-colors",children:"Edit"}),e.jsx("button",{onClick:()=>l(r.name),className:"text-xs font-bold text-red-400 hover:text-red-500 transition-colors",children:"Delete"})]})]},r.name))})]}),e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"flex items-center justify-between gap-4 border-b border-border pb-2",children:[e.jsx("h2",{className:"text-lg font-bold uppercase tracking-wider opacity-80",children:"Commentaries (TSK)"}),e.jsxs("label",{className:`text-xs font-bold uppercase tracking-wider cursor-pointer transition-colors ${o?"text-green-500 cursor-default":"hover:text-brand"}`,children:[o?"Installed ✓":"Import JSON",e.jsx("input",{type:"file",accept:".json",className:"hidden",onChange:S,disabled:o})]})]})})]})}),oe=[{id:"bgm_satie",name:"Gymnopédie No.1 (Satie)",category:"bgm",description:"Calm, melancholic classical piano.",url:"https://upload.wikimedia.org/wikipedia/commons/3/34/Erik_Satie_-_Gymnop%C3%A9die_No._1.ogg"},{id:"bgm_rain",name:"Soft Rain Ambient",category:"bgm",description:"Continuous gentle rain sound.",url:"https://upload.wikimedia.org/wikipedia/commons/8/8f/Rain_falling_on_leaves.ogg"},{id:"bgm_drone",name:"Meditation Drone",category:"bgm",description:"Deep, resonant synthetic background.",url:"data:audio/mp3;base64,//uQZAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAWgAAAA0AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABLLgAAAAAABT8AAAAAAFATAAAAAAAAAAAAAA=="},{id:"sfx_page",name:"Page Turn",category:"sfx",description:"Paper crisp flipping sound.",url:"https://upload.wikimedia.org/wikipedia/commons/f/f3/Turning_a_page.ogg"},{id:"sfx_click_soft",name:"Soft Click",category:"sfx",description:"Subtle interface click.",url:"data:audio/wav;base64,UklGRiQAAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQAAAAA="},{id:"sfx_bell",name:"Meditation Bowl",category:"sfx",description:"Resonant bell chime.",url:"https://upload.wikimedia.org/wikipedia/commons/1/18/Singing_Bowl_C_Note.ogg"}],ne=w.memo(({visuals:n,audioFiles:t,state:o,dispatch:c,onLoadData:p,showStatus:d})=>{const[u,f]=w.useState(!1),S=a=>{if(a.target.files&&a.target.files[0]){f(!0);const x=a.target.files[0],m=new FileReader;m.onload=async b=>{var g;const k={id:`vis_${Date.now()}`,name:x.name,data:(g=b.target)==null?void 0:g.result,mimeType:x.type,createdAt:Date.now()};try{await j.saveVisual(k),await p(),d(`Added image "${x.name}"`)}catch{d("Failed.",!0)}finally{f(!1)}},m.readAsDataURL(x)}},D=async()=>{f(!0);try{const a=Math.floor(Math.random()*1e3),m=await(await fetch(`https://picsum.photos/seed/${a}/1920/1080`)).blob(),b=new FileReader;b.onload=async k=>{var T;const g={id:`vis_${Date.now()}`,name:`Nature ${a}`,data:(T=k.target)==null?void 0:T.result,mimeType:m.type,source:"Picsum",createdAt:Date.now()};await j.saveVisual(g),await p(),d("Downloaded background"),f(!1)},b.readAsDataURL(m)}catch{f(!1),d("Failed",!0)}},E=async a=>{confirm("Delete?")&&(await j.deleteVisual(a),await p(),d("Deleted"))},l=(a,x)=>{if(a.target.files&&a.target.files[0]){f(!0);const m=a.target.files[0],b=new FileReader;b.onload=async k=>{var T;const g={id:`aud_${Date.now()}`,name:m.name.replace(/\.[^/.]+$/,""),category:x,data:(T=k.target)==null?void 0:T.result,mimeType:m.type,createdAt:Date.now()};try{await j.saveAudio(g),await p(),d(`Added ${x.toUpperCase()}: ${g.name}`)}catch{d("Failed to save audio.",!0)}finally{f(!1)}},b.readAsDataURL(m)}},A=async a=>{confirm("Delete this audio file?")&&(await j.deleteAudio(a),await p(),d("Deleted."))},N=async a=>{c({type:"START_DOWNLOAD",payload:a.name});try{if(a.url.startsWith("data:")){c({type:"UPDATE_PROGRESS",payload:"saving"});const x={id:`aud_${Date.now()}`,name:a.name,category:a.category,data:a.url,mimeType:a.url.split(";")[0].split(":")[1],createdAt:Date.now()};await j.saveAudio(x)}else{const x=await fetch(a.url);if(!x.ok)throw new Error("Download failed");const m=await x.blob();c({type:"UPDATE_PROGRESS",payload:"saving"});const b=new FileReader;await new Promise((k,g)=>{b.onload=async T=>{var I;const O=(I=T.target)==null?void 0:I.result,P={id:`aud_${Date.now()}`,name:a.name,category:a.category,data:O,mimeType:m.type,createdAt:Date.now()};await j.saveAudio(P),k(null)},b.onerror=g,b.readAsDataURL(m)})}await p(),d(`Downloaded ${a.name}`)}catch{d(`Failed to download ${a.name}`,!0)}finally{c({type:"END_DOWNLOAD"})}},r=t.filter(a=>a.category==="bgm"),y=t.filter(a=>a.category==="sfx");return e.jsxs("div",{className:"space-y-8 animate-in fade-in",children:[o.showAudioModal&&e.jsx("div",{className:"fixed inset-0 z-50 bg-black/50 flex items-center justify-center p-4",onClick:()=>c({type:"TOGGLE_AUDIO_MODAL",payload:!1}),children:e.jsxs("div",{className:"bg-bg border border-border w-full max-w-3xl flex flex-col max-h-[85vh] shadow-2xl",onClick:a=>a.stopPropagation(),children:[e.jsxs("div",{className:"p-4 border-b border-border flex justify-between items-center",children:[e.jsx("h3",{className:"font-bold text-lg",children:"Online Audio Library"}),e.jsx("button",{onClick:()=>c({type:"TOGGLE_AUDIO_MODAL",payload:!1}),className:"text-xl opacity-50 hover:opacity-100",children:"×"})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4",children:e.jsx("div",{className:"grid grid-cols-1 gap-4",children:oe.map((a,x)=>e.jsxs("div",{className:"flex justify-between items-center group",children:[e.jsxs("div",{className:"min-w-0 pr-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`text-[10px] font-bold uppercase px-1.5 py-0.5 rounded ${a.category==="bgm"?"bg-purple-900/30 text-purple-400":"bg-blue-900/30 text-blue-400"}`,children:a.category}),e.jsx("div",{className:"font-bold text-sm truncate",title:a.name,children:a.name})]}),e.jsx("div",{className:"text-xs opacity-60 mt-1",children:a.description})]}),e.jsx("div",{className:"flex items-center gap-3 shrink-0",children:e.jsx("button",{onClick:()=>N(a),disabled:!!o.downloadingFile,className:"text-xs font-bold uppercase tracking-wider text-brand hover:text-brand/80 disabled:opacity-50",children:o.downloadingFile===a.name?o.downloadProgress==="saving"?"Saving...":"Downloading...":"Download"})})]},x))})})]})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between gap-4 border-b border-border pb-2",children:[e.jsx("h2",{className:"text-lg font-bold uppercase tracking-wider opacity-80",children:"Background Images"}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:D,disabled:u,className:"text-xs font-bold uppercase tracking-wider hover:text-brand transition-colors disabled:opacity-50",children:u?"...":"Random"}),e.jsxs("label",{className:"text-xs font-bold uppercase tracking-wider hover:text-brand cursor-pointer transition-colors",children:["Upload",e.jsx("input",{type:"file",accept:"image/*",className:"hidden",onChange:S,disabled:u})]})]})]}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:n.length===0?e.jsx("div",{className:"col-span-full py-8 text-center opacity-50 text-sm italic",children:"No images."}):n.map(a=>e.jsxs("div",{className:"relative group aspect-video bg-black/20 overflow-hidden",children:[e.jsx("img",{src:a.data,alt:a.name,className:"w-full h-full object-cover opacity-80 group-hover:opacity-100 transition-opacity"}),e.jsx("div",{className:"absolute inset-0 flex items-end justify-end p-2 opacity-0 group-hover:opacity-100 transition-opacity bg-gradient-to-t from-black/50 to-transparent",children:e.jsx("button",{onClick:()=>E(a.id),className:"text-red-400 text-xs font-bold uppercase",children:"Delete"})})]},a.id))})]}),e.jsxs("div",{className:"space-y-4 pt-4",children:[e.jsxs("div",{className:"flex items-center justify-between gap-4 border-b border-border pb-2",children:[e.jsx("h2",{className:"text-lg font-bold uppercase tracking-wider opacity-80",children:"Background Music"}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>c({type:"TOGGLE_AUDIO_MODAL",payload:!0}),className:"text-xs font-bold uppercase tracking-wider hover:text-brand transition-colors",children:"Online"}),e.jsxs("label",{className:"text-xs font-bold uppercase tracking-wider hover:text-brand cursor-pointer transition-colors",children:["Upload",e.jsx("input",{type:"file",accept:"audio/*",className:"hidden",onChange:a=>l(a,"bgm"),disabled:u})]})]})]}),e.jsx("div",{className:"divide-y divide-border/50",children:r.length===0?e.jsx("div",{className:"py-4 text-center opacity-50 text-sm italic",children:"No background music."}):r.map(a=>e.jsxs("div",{className:"py-3 flex justify-between items-center group",children:[e.jsx("div",{className:"flex items-center gap-3",children:e.jsx("div",{className:"font-bold text-sm",children:a.name})}),e.jsxs("div",{className:"flex items-center gap-2 opacity-60 group-hover:opacity-100 transition-opacity",children:[e.jsx("audio",{src:a.data,controls:!0,className:"h-6 w-32"}),e.jsx("button",{onClick:()=>A(a.id),className:"text-red-400 text-xs font-bold uppercase ml-2 hover:text-red-500",children:"Delete"})]})]},a.id))})]}),e.jsxs("div",{className:"space-y-4 pt-4",children:[e.jsxs("div",{className:"flex items-center justify-between gap-4 border-b border-border pb-2",children:[e.jsx("h2",{className:"text-lg font-bold uppercase tracking-wider opacity-80",children:"Sound Effects"}),e.jsxs("label",{className:"text-xs font-bold uppercase tracking-wider hover:text-brand cursor-pointer transition-colors",children:["Upload",e.jsx("input",{type:"file",accept:"audio/*",className:"hidden",onChange:a=>l(a,"sfx"),disabled:u})]})]}),e.jsx("div",{className:"divide-y divide-border/50",children:y.length===0?e.jsx("div",{className:"py-4 text-center opacity-50 text-sm italic",children:"No sound effects."}):y.map(a=>e.jsxs("div",{className:"py-3 flex justify-between items-center group",children:[e.jsx("div",{className:"font-bold text-sm",children:a.name}),e.jsxs("div",{className:"flex items-center gap-2 opacity-60 group-hover:opacity-100 transition-opacity",children:[e.jsx("button",{onClick:()=>new Audio(a.data).play(),className:"text-xs font-bold uppercase hover:text-brand",children:"Preview"}),e.jsx("button",{onClick:()=>A(a.id),className:"text-red-400 text-xs font-bold uppercase ml-2 hover:text-red-500",children:"Delete"})]})]},a.id))})]})]})}),le=new Set(["the","and","of","to","in","a","that","is","he","for","it","was","his","with","as","are","not","be","but","on","they","shall","at","him","my","me","have","thou","from","thy","all","by","this","unto","which","man","god","lord","israel","son","king","people","house","came","one","out","her","she","there","their","when","up","down","said","saying","then","we","us","you","your","ye","or","if","do","did","so","an","what","who","them","see","go","come","now","no","like","into","can","will","may","upon","over","before","after"]),ie=w.memo(({collections:n,translations:t,onLoadData:o,showStatus:c,onSwitchToLibrary:p,activeTranslationId:d,activeToolTab:u,setActiveToolTab:f,selectedToolCollection:S,setSelectedToolCollection:D})=>{const[E,l]=w.useState(""),[A,N]=w.useState([]),[r,y]=w.useState(""),[a,x]=w.useState(new Set),[m,b]=w.useState(new Set),[k,g]=w.useState(""),[T,O]=w.useState(50),[P,I]=w.useState("blank"),[$,F]=w.useState(0),[G,V]=w.useState("book"),[B,X]=w.useState(""),[J,W]=w.useState([]),R=M.useMemo(()=>t.find(s=>s.id===d)||t[0],[t,d]),H=()=>{const s=ae(E);N(i=>[...i,...s.parsedReferences]),l(""),c(`Found ${s.parsedReferences.length} refs.`)},Q=async()=>{if(A.length===0||!r.trim())return;const s={name:r.trim(),verses:A.map(i=>({reference:i.referenceString,_book:i.book.replace(/\b\w/g,_=>_.toUpperCase()),_chapter:i.chapter,_startVerse:i.startVerse,_endVerse:i.endVerse})),createdAt:Date.now()};try{await j.saveCollection(s),l(""),N([]),y(""),await o(),c(`Saved "${s.name}"`),p()}catch{c("Error saving",!0)}},Z=()=>{if(a.size===0||m.size===0)return;const s=n.filter(v=>a.has(v.name)),i=t.filter(v=>m.has(v.id));let _="";s.forEach(v=>{_+=`COLLECTION: ${v.name}

`,v.verses.forEach(h=>{_+=`${h.reference}
`,i.forEach(C=>{const L=C.verses.find(U=>U._book===h._book&&U._chapter===h._chapter&&U._verse>=h._startVerse&&U._verse<=h._endVerse);_+=`[${C.displayName}] ${L?L.text:"N/A"}
`}),_+=`
`})}),g(_)},z=M.useMemo(()=>n.find(s=>s.name===S),[n,S]),K=M.useMemo(()=>!z||!R?[]:z.verses.map(i=>{const _=R.verses.find(h=>h._book===i._book&&h._chapter===i._chapter&&h._verse===i._startVerse);if(!_)return null;const v=_.text.split(" ");return{ref:i.reference,tokens:v.map((h,C)=>{const L=(Math.sin(C+$+_._verse)+1)/2<T/100;return{word:h,hidden:L}})}}).filter(i=>i!==null),[z,T,$,R]),Y=()=>{let s=[];if(!R){c("No Bible installed",!0);return}if(G==="book")s=R.verses.filter(v=>v._book===B);else{const v=n.find(h=>h.name===B);v&&v.verses.forEach(h=>{const C=R.verses.filter(L=>L._book===h._book&&L._chapter===h._chapter&&L._verse>=h._startVerse&&L._verse<=h._endVerse);s.push(...C)})}if(s.length===0){W([]),c("No text found to analyze.");return}const i={};s.forEach(v=>{v.text.toLowerCase().replace(/[.,/#!$%^&*;:{}=\-_`~()]/g,"").split(/\s+/).forEach(C=>{C&&!le.has(C)&&C.length>2&&(i[C]=(i[C]||0)+1)})});const _=Object.entries(i).map(([v,h])=>({word:v,count:h})).sort((v,h)=>h.count-v.count).slice(0,50);W(_)};return e.jsxs("div",{className:"flex flex-col h-full gap-6 animate-in fade-in",children:[e.jsxs("div",{className:"flex gap-4 border-b border-border/50 pb-2 overflow-x-auto",children:[e.jsx("button",{onClick:()=>f("extractor"),className:`text-xs font-bold uppercase tracking-wider whitespace-nowrap hover:text-brand ${u==="extractor"?"text-brand":"opacity-60"}`,children:"Extractor"}),e.jsx("button",{onClick:()=>f("compiler"),className:`text-xs font-bold uppercase tracking-wider whitespace-nowrap hover:text-brand ${u==="compiler"?"text-brand":"opacity-60"}`,children:"Compiler"}),e.jsx("button",{onClick:()=>f("memorize"),className:`text-xs font-bold uppercase tracking-wider whitespace-nowrap hover:text-brand ${u==="memorize"?"text-brand":"opacity-60"}`,children:"Memorize"}),e.jsx("button",{onClick:()=>f("analyze"),className:`text-xs font-bold uppercase tracking-wider whitespace-nowrap hover:text-brand ${u==="analyze"?"text-brand":"opacity-60"}`,children:"Analyze"})]}),u==="extractor"&&e.jsxs("div",{className:"flex flex-col gap-4 h-full",children:[e.jsx("textarea",{className:"w-full h-40 bg-bg border-b border-border p-2 focus:border-brand focus:outline-none resize-none font-serif text-sm leading-relaxed placeholder:opacity-30",placeholder:"Paste text containing Bible references here...",value:E,onChange:s=>l(s.target.value)}),e.jsx("div",{className:"flex justify-end",children:e.jsx("button",{onClick:H,className:"px-4 py-1.5 bg-brand text-white font-bold text-xs rounded hover:opacity-90",children:"Extract"})}),A.length>0&&e.jsxs("div",{className:"mt-2 pt-4 border-t border-border/50",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4 gap-2",children:[e.jsx("input",{type:"text",placeholder:"Collection Name",className:"bg-bg border-b border-border px-2 py-1 text-sm flex-1 focus:border-brand focus:outline-none font-bold",value:r,onChange:s=>y(s.target.value)}),e.jsx("button",{onClick:Q,className:"text-green-500 font-bold text-xs uppercase hover:underline",children:"Save Collection"})]}),e.jsx("div",{className:"max-h-60 overflow-y-auto space-y-1",children:A.map((s,i)=>e.jsxs("div",{className:"text-xs flex justify-between group hover:bg-white/5 p-1 rounded",children:[e.jsx("span",{children:s.referenceString}),e.jsx("button",{onClick:()=>N(_=>_.filter((v,h)=>h!==i)),className:"text-red-400 opacity-0 group-hover:opacity-100",children:"×"})]},i))})]})]}),u==="compiler"&&e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 h-64",children:[e.jsxs("div",{className:"flex-1 overflow-y-auto",children:[e.jsx("div",{className:"text-xs font-bold uppercase opacity-50 mb-2",children:"Collections"}),n.map(s=>e.jsxs("label",{className:"flex gap-2 text-xs py-1 hover:text-brand cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:a.has(s.name),onChange:()=>{const i=new Set(a);i.has(s.name)?i.delete(s.name):i.add(s.name),x(i)},className:"accent-brand"}),s.name]},s.name))]}),e.jsxs("div",{className:"flex-1 overflow-y-auto",children:[e.jsx("div",{className:"text-xs font-bold uppercase opacity-50 mb-2",children:"Translations"}),t.map(s=>e.jsxs("label",{className:"flex gap-2 text-xs py-1 hover:text-brand cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:m.has(s.id),onChange:()=>{const i=new Set(m);i.has(s.id)?i.delete(s.id):i.add(s.id),b(i)},className:"accent-brand"}),s.displayName]},s.id))]})]}),e.jsx("button",{onClick:Z,className:"bg-brand text-white font-bold py-2 rounded text-sm hover:opacity-90",children:"Compile Output"}),e.jsx("textarea",{readOnly:!0,value:k,className:"h-40 bg-black/10 p-4 font-mono text-xs resize-none rounded",placeholder:"Output will appear here..."})]}),u==="memorize"&&e.jsxs("div",{className:"flex flex-col gap-6",children:[e.jsxs("div",{className:"flex flex-wrap gap-4 items-center border-b border-border/50 pb-4",children:[e.jsxs("select",{value:S,onChange:s=>D(s.target.value),className:"bg-bg border-b border-border px-2 py-1 text-sm font-bold focus:border-brand outline-none",children:[e.jsx("option",{value:"",disabled:!0,children:"Select Collection"}),n.map(s=>e.jsx("option",{value:s.name,children:s.name},s.name))]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("label",{className:"text-xs font-bold opacity-60 uppercase",children:"Difficulty"}),e.jsx("input",{type:"range",min:"0",max:"100",step:"10",value:T,onChange:s=>O(Number(s.target.value)),className:"accent-brand w-24 h-1 bg-border rounded-lg appearance-none cursor-pointer"}),e.jsxs("span",{className:"text-xs font-mono w-8",children:[T,"%"]})]}),e.jsx("button",{onClick:()=>F(Date.now()),className:"text-xs font-bold uppercase hover:text-brand",children:"Reshuffle"})]}),e.jsx("div",{className:"flex-1 overflow-y-auto space-y-8",children:S?K.length===0?e.jsx("div",{className:"text-center opacity-50 text-sm mt-10 text-red-400",children:"Verses not found in active translation."}):K.map((s,i)=>e.jsxs("div",{className:"pb-6 border-b border-border/30 last:border-0",children:[e.jsx("div",{className:"text-xs font-bold text-brand uppercase mb-2",children:s.ref}),e.jsx("p",{className:"font-serif text-lg leading-loose",children:s.tokens.map((_,v)=>e.jsx(de,{word:_.word,hidden:_.hidden,mode:P},v))})]},i)):e.jsx("div",{className:"text-center opacity-50 text-sm mt-10 italic",children:"Select a collection above to start."})})]}),u==="analyze"&&e.jsxs("div",{className:"flex flex-col gap-6",children:[e.jsxs("div",{className:"flex flex-wrap gap-4 items-center border-b border-border/50 pb-4",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>V("book"),className:`text-xs font-bold uppercase ${G==="book"?"text-brand":"opacity-60"}`,children:"Book"}),e.jsx("span",{className:"opacity-30",children:"/"}),e.jsx("button",{onClick:()=>V("collection"),className:`text-xs font-bold uppercase ${G==="collection"?"text-brand":"opacity-60"}`,children:"Collection"})]}),e.jsxs("select",{value:B,onChange:s=>X(s.target.value),className:"bg-bg border-b border-border px-2 py-1 text-sm font-bold focus:border-brand outline-none flex-1 max-w-xs",children:[e.jsx("option",{value:"",disabled:!0,children:"Select Target"}),G==="book"?Array.from(new Set(R==null?void 0:R.verses.map(s=>s._book))).map(s=>e.jsx("option",{value:s,children:s},s)):n.map(s=>e.jsx("option",{value:s.name,children:s.name},s.name))]}),e.jsx("button",{onClick:Y,className:"text-xs font-bold uppercase bg-brand text-white px-3 py-1 rounded hover:opacity-90",children:"Run"})]}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:J.length===0?e.jsx("div",{className:"text-center opacity-50 text-sm mt-10 italic",children:"Select source and run analysis."}):e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-4",children:J.map((s,i)=>e.jsxs("div",{className:"flex justify-between items-center border-b border-border/30 pb-1",children:[e.jsx("span",{className:"font-bold text-sm capitalize",children:s.word}),e.jsx("span",{className:"text-xs font-mono opacity-60",children:s.count})]},i))})})]})]})}),de=w.memo(({word:n,hidden:t,mode:o})=>{const[c,p]=w.useState(!1);if(w.useEffect(()=>{p(!1)},[t,n]),!t||c)return e.jsx("span",{className:"mr-1.5",children:n});const d=o==="firstLetter"?n.charAt(0)+"_".repeat(n.length-1):"_".repeat(n.length);return e.jsx("span",{onClick:()=>p(!0),className:"mr-1.5 cursor-pointer text-brand/50 font-bold hover:text-brand transition-colors select-none bg-brand/5 px-1 rounded",title:"Click to reveal",children:d})}),ce={activeTab:"bibles",translations:[],collections:[],plans:[],visuals:[],audioFiles:[],hasTSK:!1,statusMsg:null,isLoadingData:!1,isProcessingImport:!1,showRepoModal:!1,repoFiles:[],isRepoLoading:!1,repoSearch:"",downloadingFile:null,downloadProgress:null,showAudioModal:!1,activeToolTab:"extractor",selectedToolCollection:""};function pe(n,t){switch(t.type){case"SET_TAB":return{...n,activeTab:t.payload};case"LOAD_DATA_START":return{...n,isLoadingData:!0};case"LOAD_DATA_SUCCESS":return{...n,translations:t.payload.t,collections:t.payload.c,plans:t.payload.p,visuals:t.payload.v,audioFiles:t.payload.a,hasTSK:t.payload.tsk,isLoadingData:!1};case"SET_STATUS":return{...n,statusMsg:t.payload};case"SET_PROCESSING":return{...n,isProcessingImport:t.payload};case"TOGGLE_REPO_MODAL":return{...n,showRepoModal:t.payload};case"SET_REPO_FILES":return{...n,repoFiles:t.payload};case"SET_REPO_LOADING":return{...n,isRepoLoading:t.payload};case"SET_REPO_SEARCH":return{...n,repoSearch:t.payload};case"START_DOWNLOAD":return{...n,downloadingFile:t.payload,downloadProgress:0};case"UPDATE_PROGRESS":return{...n,downloadProgress:t.payload};case"END_DOWNLOAD":return{...n,downloadingFile:null,downloadProgress:null};case"TOGGLE_AUDIO_MODAL":return{...n,showAudioModal:t.payload};case"SET_TOOL_TAB":return{...n,activeToolTab:t.payload};case"SET_TOOL_COLLECTION":return{...n,selectedToolCollection:t.payload};case"NAVIGATE_TO_TOOL":return{...n,activeTab:"tools",activeToolTab:t.payload.tool,selectedToolCollection:t.payload.collection||""};default:return n}}function me({activeTranslationId:n}){const[t,o]=M.useReducer(pe,ce),c=M.useCallback(async()=>{o({type:"LOAD_DATA_START"});const d=await j.getTranslations(),u=await j.getCollections(),f=await j.getPlans(),S=await j.getVisuals(),D=await j.getAudio(),E=await j.hasTSKData();o({type:"LOAD_DATA_SUCCESS",payload:{t:d,c:u,p:f,v:S,a:D,tsk:E}})},[]);M.useEffect(()=>{c()},[c]);const p=M.useCallback((d,u=!1)=>{o({type:"SET_STATUS",payload:{msg:d,error:u}}),setTimeout(()=>o({type:"SET_STATUS",payload:null}),4e3)},[]);return e.jsxs("div",{className:"min-h-screen bg-bg text-text p-4 sm:p-8 max-w-4xl mx-auto font-sans animate-in fade-in duration-300 pt-20 pb-20",children:[e.jsx("div",{className:"flex items-center justify-between mb-8 border-b border-border pb-4",children:e.jsx("h1",{className:"text-2xl font-bold",children:"Data Manager"})}),t.statusMsg&&e.jsx("div",{className:`mb-6 p-3 rounded text-sm font-semibold ${t.statusMsg.error?"bg-red-900/20 text-red-400 border border-red-900/50":"bg-green-900/20 text-green-400 border border-green-900/50"}`,children:t.statusMsg.msg}),e.jsx("div",{className:"flex gap-6 mb-8 border-b border-border/50 overflow-x-auto",children:["bibles","library","media","tools"].map(d=>e.jsx("button",{onClick:()=>o({type:"SET_TAB",payload:d}),className:`pb-3 font-bold text-sm uppercase tracking-wider transition-all border-b-2 whitespace-nowrap ${t.activeTab===d?"text-brand border-brand":"text-text/50 border-transparent hover:text-text"}`,children:d},d))}),e.jsxs("div",{className:"min-h-[400px]",children:[t.activeTab==="bibles"&&e.jsx(te,{translations:t.translations,state:t,dispatch:o,onLoadData:c,showStatus:p,activeTranslationId:n}),t.activeTab==="library"&&e.jsx(re,{collections:t.collections,plans:t.plans,hasTSK:t.hasTSK,onLoadData:c,showStatus:p,onEditCollection:()=>o({type:"SET_TAB",payload:"tools"}),onMemorizeCollection:d=>o({type:"NAVIGATE_TO_TOOL",payload:{tool:"memorize",collection:d}}),dispatch:o}),t.activeTab==="media"&&e.jsx(ne,{visuals:t.visuals,audioFiles:t.audioFiles,state:t,dispatch:o,onLoadData:c,showStatus:p}),t.activeTab==="tools"&&e.jsx(ie,{collections:t.collections,translations:t.translations,onLoadData:c,showStatus:p,onSwitchToLibrary:()=>o({type:"SET_TAB",payload:"library"}),activeTranslationId:n,activeToolTab:t.activeToolTab,setActiveToolTab:d=>o({type:"SET_TOOL_TAB",payload:d}),selectedToolCollection:t.selectedToolCollection,setSelectedToolCollection:d=>o({type:"SET_TOOL_COLLECTION",payload:d})})]})]})}export{me as DataManager};
